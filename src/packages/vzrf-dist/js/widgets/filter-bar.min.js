/*! VZRF Version 2.20.0 */
function filterBarInit(e){var t=getContext(e);$vf("[data-filter-bar]",t).each(function(){var e=$vf(this);$vf("[data-filter-bar-item]",e).each(function(){$vf(this).is("[data-multi-select]")?updateMultiFilter($vf(this)):updateSingleFilter($vf(this),!0)})}),$vf(document).off("click keypress","[data-filter-bar-item]:not(.disabled)"),$vf(document).on("click keypress","[data-filter-bar-item]:not(.disabled)",function(e){if(keyClick(e)===!0){e.preventDefault();var t=$vf(e.target),a=$vf(this);if(t.is("[data-filter-bar-choices], [data-filter-bar-choices] *"))return!1;if(a.is(".active"))return closeFilter(a),!1;if($vf("[data-filter-bar-item].active").length)return closeFilter(a),!1;if(!(a.find("[data-filter-bar-choices] li").length>1))return!1;$vf("[data-filter-bar-item].active").removeClass("active"),openFilter(a)}}),t.off("click keypress","[data-filter-bar-choices] li"),t.on("click keypress","[data-filter-bar-choices] li",function(e){if(keyClick(e)===!0){e.preventDefault();var t=$vf(this),a=t.closest("[data-filter-bar-item]");if(t.trigger("beforeClickFilterChoice"),a.is("[data-multi-select]")){var i=$vf("[data-filter-bar-choices] li.active",a),r=parseInt(a.attr("data-multi-select"))||1/0,l=i.length;t.hasClass("active")?t.removeClass("active"):r>l?t.addClass("active"):l==r&&($vf("[data-filter-bar-selected]",a).addClass("shake"),setTimeout(function(){$vf("[data-filter-bar-selected]",a).removeClass("shake")},500)),updateMultiFilter(a)}else t.siblings().removeClass("active"),t.addClass("active"),t.closest("[data-filter-bar-choices]").removeClass("active"),updateSingleFilter(a,t);t.trigger("afterClickFilterChoice")}}),t.off("mouseleave","[data-filter-bar] [data-filter-bar-item].active"),t.on("mouseleave","[data-filter-bar] [data-filter-bar-item].active",function(){var e=$vf(this),t=setTimeout(function(){closeFilter(e)},300);e.on("mouseenter",function(){clearTimeout(t)})}),t.off("click keypress",".page-overlay.filterbar, .nested-overlay"),t.on("click keypress",".page-overlay.filterbar, .nested-overlay",function(e){if(keyClick(e)===!0){var t=$vf("[data-filter-bar-item].active");t.length&&closeFilter(t)}}),$vf("[data-filter-bar-item]").each(function(){var e=$vf(this);e[0].hasAttribute("tabindex")===!1&&e.attr("tabindex",0),e.attr("role","combobox")}),$vf("[data-filter-bar-choices]").attr({role:"listbox","aria-labelledby":"listlabel"}),$vf("[data-filter-bar-choices]").prop("hidden",!0),$vf("[data-filter-bar-choices] li").attr({role:"option","aria-selected":"false"}),$vf("[data-filter-bar-choices] li.active").attr({"aria-selected":"true"}),t.off("keydown","[data-filter-bar-item]:not(.disabled)"),t.on("keydown","[data-filter-bar-item]:not(.disabled)",function(e){var t=$vf(this),a=e.which,i=$vf(e.target);if(i.is("[data-filter-bar-item]:not(.disabled)"))if(t.is(".active"))27===a?(e.preventDefault(),closeFilter(t)):e.altKey&&38===e.which||e.altKey&&40===e.which?(e.preventDefault(),closeFilter(t)):a>=36&&40>=a?(e.preventDefault(),$vf(".filter-bar_choices",t).children().first().focus()):35===a?(e.preventDefault(),$vf(".filter-bar_choices",t).children().last().focus()):9===a&&closeFilter(t,!0);else if(e.altKey&&38===e.which||e.altKey&&40===e.which){if(!(t.find("[data-filter-bar-choices] li").length>1))return!1;$vf("[data-filter-bar-item].active").removeClass("active"),openFilter(t)}}),t.off("keydown","[data-filter-bar-choices] li"),t.on("keydown","[data-filter-bar-choices] li",function(e){var t=$vf(this),a=$vf(e.target),i=t.closest("[data-filter-bar-item]"),r=$vf("[data-filter-bar-choices] li",i),l=e.which;a.is("[data-filter-bar-item]:not(.disabled)")||i.is(".active")&&(36===l?(e.preventDefault(),r.first().focus()):35===l?(e.preventDefault(),r.last().focus()):e.altKey&&38===e.which||e.altKey&&40===e.which?(e.preventDefault(),closeFilter(i)):39===l||40===l?(e.preventDefault(),t.is(":last-child")?t.focus():t.next().focus()):38===l||37===l?(e.preventDefault(),t.is(":first-child")?t.focus():t.prev().focus()):27===l?closeFilter(i):9===l&&(i.is("[data-multi-select]")?(t.closest("[data-filter-bar-item]").focus(),closeFilter(i,!0)):(t.siblings().removeClass("active"),t.addClass("active"),t.closest("[data-filter-bar-choices]").removeClass("active"),updateSingleFilter(i,!1,t,!0))))})}function openFilter(e){if(e.trigger("beforeOpenFilter"),e.addClass("active"),setChoiceListHeight(e),saveFocus(),e.closest("[data-modal]").length>0){var t=e.closest("[data-modal]"),a=$vf("[data-modal-header], [data-modal-content], [data-modal-footer]",t);a.each(function(){$vf(this).append('<div class="nested-overlay" />')}),$vf(".nested-overlay",t).addClass("active invisible filterbar")}else{$vf(".page-overlay").length<1&&$vf("body").append('<div class="page-overlay vzrf"></div>');var i=$vf(".page-overlay");e.closest(".main").length?i.appendTo(e.closest(".main")):$vf(".page.active").length&&i.appendTo(".page.active"),$vf(".page-overlay").addClass("active invisible filterbar")}$vf(window).on("orientationchange",function(){closeFilter(e)}),$vf(".filter-bar_choices",e).prop("hidden",!1),$vf(".filter-bar_choices",e).children().attr({tabindex:-1}),e.trigger("afterOpenFilter")}function closeFilter(e,t){e.trigger("beforeCloseFilter"),e.removeClass("active"),setChoiceListHeight(e,!0);var a;e.closest("[data-modal]").length>0?(a=e.closest("[data-modal]").find(".nested-overlay"),a.removeClass("active invisible filterbar"),setTimeout(function(){a.remove()},250)):(a=$vf(".page-overlay.filterbar"),a.removeClass("active invisible filterbar"),$vf(".page.active").length>0&&setTimeout(function(){a.appendTo("body")},250)),t!==!0&&setTimeout(function(){resetFocus()},350),$vf(".filter-bar_choices",e).prop("hidden",!0),$vf(window).off("orientationchange"),e.trigger("afterCloseFilter")}function updateSingleFilter(e,t,a,i){e.trigger("beforeUpdateSingleFilter");var r;e.find(":focus");a?r=$vf("a",a).text():e.has("li.active").length>0?r=$vf("li.active a",e).text():(r=$vf("[data-filter-bar-choices] li:first-child a",e).text(),$vf("[data-filter-bar-choices] li:first-child",e).addClass("active")),$vf("[data-filter-bar-selected]",e).text(r),1!=t&&closeFilter(e,i),e.trigger("afterUpdateSingleFilter")}function updateMultiFilter(e){e.trigger("beforeUpdateMultiFilter");var t="Make a selection";e.is("[data-null-text]")&&(t=e.attr("data-null-text"));var a="# Item~ Selected";e.is("[data-count-text]")&&(a=e.attr("data-count-text"));var i,r=$vf("[data-filter-bar-choices] li.active",e).length;r>1?(a=a.replace("#",r),i=a.replace("~","s")):1==r?e.is("[data-count-text-singular]")?(a=a.replace("#",r),i=a.replace("~","")):i=$vf(".active a",e).text():1>r&&(i=t),$vf("[data-filter-bar-selected]",e).text(i),e.trigger("afterUpdateMultiFilter")}function setChoiceListHeight(e,t){e.trigger("beforeSetChoiceListHeight");var a=$vf(window).height(),i=$vf("[data-filter-bar-choices]",e).height(),r=e[0].getBoundingClientRect().bottom,l=a-r;if(i>l&&!t){var s=l-15;$vf("[data-filter-bar-choices]",e).css({height:s,"min-height":120,overflow:"auto"});var c=document.createElement("div");c.className="scrollbar-measure",document.body.appendChild(c),$vf(".scrollbar-measure").css({width:100,height:100,overflow:"scroll",position:"absolute",top:-9999});var o=c.offsetWidth-c.clientWidth;document.body.removeChild(c),o>0&&$vf("[data-filter-bar-choices] > li > a",e).css("text-overflow","clip")}else t&&setTimeout(function(){$vf("[data-filter-bar-choices]",e).removeAttr("style"),$vf("[data-filter-bar-choices] > li > a",e).removeAttr("style")},500);e.trigger("afterSetChoiceListHeight")}